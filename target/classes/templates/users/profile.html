<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${profileUser.username} + ' - Profile - BookClub'">User Profile - BookClub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand" th:href="@{/dashboard}">BookClub</a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" th:href="@{/dashboard}">Dashboard</a>
            <a class="nav-link" th:href="@{/bookspaces}">My Bookspaces</a>
            <a class="nav-link" th:href="@{/search}">Find Friends</a>
            <span class="navbar-text me-3" th:if="${currentUser}" th:text="'Welcome, ' + ${currentUser.username}">Welcome, User</span>
            <a class="nav-link" th:href="@{/logout}">Logout</a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a th:href="@{/dashboard}">Dashboard</a></li>
            <li class="breadcrumb-item"><a th:href="@{/search}">Find Friends</a></li>
            <li class="breadcrumb-item active" th:text="${profileUser.username}">User Profile</li>
        </ol>
    </nav>

    <div class="row">
        <!-- Profile Information -->
        <div class="col-lg-4">
            <div class="card mb-4">
                <div class="card-body text-center">
                    <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3"
                         style="width: 100px; height: 100px;">
                        <i class="fas fa-user text-white fa-3x"></i>
                    </div>
                    <h4 class="card-title" th:text="${profileUser.username}">Username</h4>
                    <p class="text-muted" th:text="${profileUser.email}">user@example.com</p>

                    <!-- Bio -->
                    <div th:if="${profileUser.bio != null and !profileUser.bio.isEmpty()}" class="mb-3">
                        <p class="card-text" th:text="${profileUser.bio}">User bio goes here...</p>
                    </div>

                    <!-- Member Since -->
                    <p class="text-muted small">
                        <i class="fas fa-calendar-alt me-1"></i>
                        Member since <span th:text="${#temporals.format(profileUser.createdAt, 'MMMM yyyy')}">Date</span>
                    </p>
                </div>
            </div>

            <!-- Stats Card -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Statistics</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="border-end">
                                <h4 class="text-primary" th:text="${profileUser.booksReadCount ?: 0}">0</h4>
                                <small class="text-muted">Books Read</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <h4 class="text-success" th:text="${friendCount ?: 0}">0</h4>
                            <small class="text-muted">Friends</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-lg-8">
            <!-- Action Buttons (if not viewing own profile) -->
            <div th:if="${!isOwnProfile}" class="card mb-4">
                <div class="card-body">
                    <div class="d-flex gap-2 justify-content-center">
                        <!-- Add Friend Button (if not friends) -->
                        <form th:if="${!isFriend}" th:action="@{'/users/' + ${profileUser.username} + '/add-friend'}" method="post" style="display: inline;">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-user-plus me-2"></i>Add Friend
                            </button>
                        </form>

                        <!-- Remove Friend Button (if friends) -->
                        <form th:if="${isFriend}" th:action="@{'/users/' + ${profileUser.username} + '/remove-friend'}" method="post" style="display: inline;">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <button type="submit" class="btn btn-outline-danger"
                                    onclick="return confirm('Are you sure you want to remove this friend?')">
                                <i class="fas fa-user-times me-2"></i>Remove Friend
                            </button>
                        </form>

                        <a href="#" class="btn btn-outline-primary">
                            <i class="fas fa-envelope me-2"></i>Send Message
                        </a>
                    </div>
                </div>
            </div>

            <!-- User's Bookspaces -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-book me-2"></i>
                        <span th:text="${isOwnProfile ? 'My Bookspaces' : profileUser.username + '''s Bookspaces'}">Bookspaces</span>
                        <span class="badge bg-secondary ms-2" th:text="${#lists.size(bookspaces)}">0</span>
                    </h5>
                </div>
                <div class="card-body">
                    <div th:if="${bookspaces == null or #lists.isEmpty(bookspaces)}" class="text-center text-muted py-4">
                        <i class="fas fa-book-open fa-3x mb-3"></i>
                        <h6 th:text="${isOwnProfile ? 'No bookspaces yet' : 'No public bookspaces'}">No bookspaces</h6>
                        <p class="mb-0" th:text="${isOwnProfile ? 'Create your first bookspace to get started!' : 'This user hasn\''t created any bookspaces yet.'}">No bookspaces message</p>
                        <a th:if="${isOwnProfile}" th:href="@{/bookspaces/create}" class="btn btn-primary mt-2">
                            Create Your First Bookspace
                        </a>
                    </div>

                    <!-- Display bookspaces -->
                    <div th:unless="${bookspaces == null or #lists.isEmpty(bookspaces)}" class="row">
                        <div th:each="bookspace : ${bookspaces}" class="col-md-6 mb-3">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body">
                                    <h6 class="card-title">
                                        <a th:href="@{'/bookspaces/' + ${bookspace.id}}" th:text="${bookspace.title}" class="text-decoration-none">Bookspace Title</a>
                                    </h6>
                                    <p class="card-text text-muted small" th:text="${#strings.abbreviate(bookspace.description, 100)}">Description...</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-muted" th:text="${#temporals.format(bookspace.createdAt, 'MMM dd, yyyy')}">Date</small>
                                        <small class="text-muted">
                                            <i class="fas fa-book-open me-1"></i>
                                            <span>Bookspace</span>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-clock me-2"></i>
                        <span th:text="${isOwnProfile ? 'My Recent Activity' : 'Recent Activity'}">Recent Activity</span>
                    </h5>
                </div>
                <div class="card-body">
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-activity fa-3x mb-3"></i>
                        <h6>No recent activity</h6>
                        <p class="mb-0" th:text="${isOwnProfile ? 'Start participating in discussions to see your activity here!' : 'This user hasn\''t been active recently.'}">No activity message</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
